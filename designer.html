<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hammerspoon Workspace Designer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        /* WORKSPACE DESIGNER - 50% of screen */
        .workspace-designer {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow-y: auto;
            height: 100%;
        }

        .designer-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 25px;
            text-align: center;
            color: #4a5568;
        }

        .monitors-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr 140px;
            gap: 15px;
            height: 100%;
            min-height: 600px;
            padding: 10px;
            box-sizing: border-box;
        }

        .monitor-container {
            background: #f7fafc;
            border: 3px solid #4a5568;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            overflow: hidden;
            min-height: 180px;
        }

        .monitor-container:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Different monitor sizes */
        .monitor1 { 
            grid-column: 1; 
            grid-row: 1;
            min-height: 180px;
        }
        .monitor2 { 
            grid-column: 2; 
            grid-row: 1;
            min-height: 180px;
        }
        .monitor3 { 
            grid-column: 1 / 3; 
            grid-row: 2;
            min-height: 140px;
        }
        .monitor4 { 
            grid-column: 1 / 3; 
            grid-row: 3;
            min-height: 140px;
        }

        .monitor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .monitor-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #2d3748;
        }

        .split-selector {
            padding: 5px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: white;
            font-size: 0.9rem;
        }

        .monitor-zones {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            overflow: hidden;
            min-height: 0;
        }

        .drop-zone {
            background: white;
            border: 2px dashed #cbd5e0;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
            color: #718096;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 60px;
            max-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            flex: 1;
        }

        .drop-zone:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .drop-zone.has-app {
            border-style: solid;
            border-color: #667eea;
            background: #e6f3ff;
        }

        .app-in-zone {
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .zone-selector {
            width: 100%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
            font-size: 0.8rem;
            margin-top: 4px;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .remove-app {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Ultrawide splits */
        .monitor3 .monitor-zones.split-2 {
            flex-direction: row;
        }

        .monitor3 .monitor-zones.split-3 {
            flex-direction: row;
        }

        /* RIGHT SIDEBAR */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            height: 100%;
        }

        /* Workspace Presets */
        .preset-manager {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .preset-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .preset-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .preset-input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.9rem;
            flex: 1;
            min-width: 120px;
        }

        .preset-list {
            max-height: 150px;
            overflow-y: auto;
        }

        .preset-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preset-item.active {
            border-color: #667eea;
            background: #e6f3ff;
        }

        .preset-info {
            flex: 1;
        }

        .preset-name {
            font-weight: bold;
            color: #4a5568;
            font-size: 0.9rem;
        }

        .preset-hotkey {
            font-size: 0.8rem;
            color: #666;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .preset-actions {
            display: flex;
            gap: 5px;
        }

        .preset-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .preset-btn.load {
            background: #667eea;
            color: white;
        }

        .preset-btn.delete {
            background: #e53e3e;
            color: white;
        }

        .app-library {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .library-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .app-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .app-item {
            background: #667eea;
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            cursor: grab;
            font-size: 0.9rem;
            transition: transform 0.2s ease;
        }

        .app-item:hover {
            transform: scale(1.05);
        }

        .app-item:active {
            cursor: grabbing;
        }

        .generated-script {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 250px;
            flex-shrink: 0;
        }

        .script-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .code-preview {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            overflow-y: auto;
            max-height: 200px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        /* Keystroke Display */
        .keystroke-display {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            flex-shrink: 0;
        }

        .hotkey {
            font-size: 2rem;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            background: #f7fafc;
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid #667eea;
            display: inline-block;
        }

        .hotkey-desc {
            font-size: 1rem;
            color: #666;
        }

        /* Installation Instructions */
        .installation-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .installation-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .step {
            margin-bottom: 15px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .step-number {
            font-weight: bold;
            color: #667eea;
            margin-right: 8px;
        }

        .file-path {
            background: #2d3748;
            color: #e2e8f0;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }

        /* Drag and Drop Effects */
        .dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .drag-over {
            border-color: #38a169 !important;
            background: #f0fff4 !important;
            border-style: solid !important;
        }

        /* Bottom Instructions */
        .bottom-instructions {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 15px;
            flex-shrink: 0;
            max-height: 150px;
            overflow-y: auto;
        }

        @media (max-width: 1200px) {
            body {
                height: auto;
                min-height: 100vh;
                overflow: auto;
            }
            
            .container {
                height: auto;
                min-height: 100vh;
                padding: 15px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
                gap: 15px;
                height: auto;
                min-height: 0;
            }
            
            .workspace-designer {
                height: auto;
                overflow-y: visible;
            }
            
            .sidebar {
                height: auto;
            }
            
            .bottom-instructions {
                max-height: none;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñ•Ô∏è Hammerspoon Workspace Designer</h1>
            <p>Drag applications onto monitors ‚Ä¢ Configure splits ‚Ä¢ Generate Lua script</p>
        </div>

        <!-- Current Preset Display -->
        <div class="keystroke-display">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                <div style="text-align: center;">
                    <div class="hotkey">‚åò‚å•‚åÉG</div>
                    <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">Gentle Mode</div>
                    <div style="font-size: 0.8rem; color: #888;">Arrange without closing apps</div>
                </div>
                <div style="text-align: center;">
                    <div class="hotkey">‚åò‚å•‚åÉW</div>
                    <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">Full Reset</div>
                    <div style="font-size: 0.8rem; color: #888;">Close & restart everything</div>
                </div>
            </div>
            <div class="hotkey-desc" id="presetDesc">Configure your workspace below - generates both modes</div>
        </div>

        <div class="main-content">
            <!-- WORKSPACE DESIGNER -->
            <div class="workspace-designer">
                <div class="designer-title">Visual Workspace Configuration</div>
                <div class="monitors-grid">
                    
                    <!-- Monitor 1 -->
                    <div class="monitor-container monitor1">
                        <div class="monitor-header">
                            <div class="monitor-name">Monitor 1 (Samsung LU28R55)</div>
                            <select class="split-selector" data-monitor="1">
                                <option value="single">Single App</option>
                                <option value="split-2" selected>Top/Bottom Split</option>
                            </select>
                        </div>
                        <div class="monitor-zones split-2">
                            <div class="drop-zone" data-monitor="1" data-zone="top">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Top Half</div>
                                <select class="zone-selector" data-monitor="1" data-zone="top">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                            <div class="drop-zone" data-monitor="1" data-zone="bottom">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Bottom Half</div>
                                <select class="zone-selector" data-monitor="1" data-zone="bottom">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Monitor 2 -->
                    <div class="monitor-container monitor2">
                        <div class="monitor-header">
                            <div class="monitor-name">Monitor 2 (Samsung LU28R55)</div>
                            <select class="split-selector" data-monitor="2">
                                <option value="single">Single App</option>
                                <option value="split-2" selected>Top/Bottom Split</option>
                            </select>
                        </div>
                        <div class="monitor-zones split-2">
                            <div class="drop-zone" data-monitor="2" data-zone="top">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Top Half</div>
                                <select class="zone-selector" data-monitor="2" data-zone="top">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                            <div class="drop-zone" data-monitor="2" data-zone="bottom">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Bottom Half</div>
                                <select class="zone-selector" data-monitor="2" data-zone="bottom">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Monitor 3 (Ultrawide) -->
                    <div class="monitor-container monitor3">
                        <div class="monitor-header">
                            <div class="monitor-name">Monitor 3 (LG UltraWide)</div>
                            <select class="split-selector" data-monitor="3">
                                <option value="single" selected>Single App (Fullscreen)</option>
                                <option value="split-2">50/50 Split</option>
                                <option value="split-3">1/3 ‚Ä¢ 1/3 ‚Ä¢ 1/3 Split</option>
                            </select>
                        </div>
                        <div class="monitor-zones single">
                            <div class="drop-zone" data-monitor="3" data-zone="full">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Fullscreen</div>
                                <select class="zone-selector" data-monitor="3" data-zone="full">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Monitor 4 (MacBook) -->
                    <div class="monitor-container monitor4">
                        <div class="monitor-header">
                            <div class="monitor-name">Monitor 4 (MacBook Retina)</div>
                            <select class="split-selector" data-monitor="4">
                                <option value="single" selected>Single App</option>
                                <option value="split-2">Left/Right Split</option>
                            </select>
                        </div>
                        <div class="monitor-zones single">
                            <div class="drop-zone" data-monitor="4" data-zone="full">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Fullscreen</div>
                                <select class="zone-selector" data-monitor="4" data-zone="full">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="sidebar">
                <!-- Workspace Presets -->
                <div class="preset-manager">
                    <div class="preset-title">üè† Workspace Presets</div>
                    
                    <div class="preset-controls">
                        <input type="text" id="presetName" class="preset-input" placeholder="Preset name (e.g., Development Mode)">
                        <select id="presetHotkey" class="preset-input">
                            <option value="cmd,alt,ctrl,W">‚åò‚å•‚åÉW</option>
                            <option value="cmd,alt,ctrl,D">‚åò‚å•‚åÉD</option>
                            <option value="cmd,alt,ctrl,M">‚åò‚å•‚åÉM</option>
                            <option value="cmd,alt,ctrl,F">‚åò‚å•‚åÉF</option>
                            <option value="cmd,alt,ctrl,1">‚åò‚å•‚åÉ1</option>
                            <option value="cmd,alt,ctrl,2">‚åò‚å•‚åÉ2</option>
                            <option value="cmd,alt,ctrl,3">‚åò‚å•‚åÉ3</option>
                        </select>
                        <button class="btn btn-primary" onclick="savePreset()" style="flex: none;">Save</button>
                    </div>
                    
                    <div class="preset-list" id="presetList">
                        <!-- Presets will be populated here -->
                    </div>
                </div>

                <!-- App Library -->
                <div class="app-library">
                    <div class="library-title">üì± Application Library</div>
                    <div class="app-grid">
                        <div class="app-item" draggable="true" data-app="Microsoft Outlook">Outlook</div>
                        <div class="app-item" draggable="true" data-app="Microsoft Teams">Teams</div>
                        <div class="app-item" draggable="true" data-app="Notion">Notion</div>
                        <div class="app-item" draggable="true" data-app="Red Sands">Red Sands</div>
                        <div class="app-item" draggable="true" data-app="ChatGPT">ChatGPT</div>
                        <div class="app-item" draggable="true" data-app="Claude">Claude</div>
                        <div class="app-item" draggable="true" data-app="Perplexity- Ask Anything">Perplexity</div>
                        <div class="app-item" draggable="true" data-app="Cursor">Cursor</div>
                        <div class="app-item" draggable="true" data-app="GitHub Desktop">GitHub</div>
                        <div class="app-item" draggable="true" data-app="Messages">Messages</div>
                        <div class="app-item" draggable="true" data-app="Microsoft Excel">Excel</div>
                        <div class="app-item" draggable="true" data-app="Microsoft Word">Word</div>
                        <div class="app-item" draggable="true" data-app="Microsoft PowerPoint">PowerPoint</div>
                        <div class="app-item" draggable="true" data-app="Hammerspoon">Console</div>
                        <div class="app-item" draggable="true" data-app="Google Chrome">Chrome</div>
                        <div class="app-item" draggable="true" data-app="Microsoft Edge">Edge</div>
                        <div class="app-item" draggable="true" data-app="Safari">Safari</div>
                        <div class="app-item" draggable="true" data-app="Perplexity Comet">Comet</div>
                    </div>
                </div>

                <!-- Generated Script -->
                <div class="generated-script">
                    <div class="script-title">‚ö° Generated Lua Script</div>
                    <div class="code-preview" id="generatedCode">
-- Configure your workspace above
-- Script will generate automatically
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="copyScript()">üìã Copy Script</button>
                        <button class="btn btn-secondary" onclick="downloadScript()">üíæ Download</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Instructions -->
        <div class="bottom-instructions">
            <div class="installation-title">üì• How to Install in Hammerspoon</div>
            
            <div class="step">
                <span class="step-number">1.</span>
                <strong>Install Hammerspoon:</strong> Download from <a href="https://www.hammerspoon.org/" target="_blank">hammerspoon.org</a> if you haven't already
            </div>
            
            <div class="step">
                <span class="step-number">2.</span>
                <strong>Configure workspace:</strong> Drag apps from the library onto monitors and configure splits as needed
            </div>
            
            <div class="step">
                <span class="step-number">3.</span>
                <strong>Copy generated script:</strong> Use the "Copy Script" button - it includes both Gentle (‚åò‚å•‚åÉG) and Full Reset (‚åò‚å•‚åÉW) modes
            </div>
            
            <div class="step">
                <span class="step-number">4.</span>
                <strong>Open Hammerspoon config:</strong> Click Hammerspoon menu bar icon ‚Üí "Open Config" or edit <span class="file-path">~/.hammerspoon/init.lua</span>
            </div>
            
            <div class="step">
                <span class="step-number">5.</span>
                <strong>Paste into config:</strong> Add the generated code to your <span class="file-path">init.lua</span> file
            </div>
            
            <div class="step">
                <span class="step-number">6.</span>
                <strong>Reload Hammerspoon:</strong> Click Hammerspoon menu bar icon ‚Üí "Reload Config"
            </div>
            
            <div class="step">
                <span class="step-number">7.</span>
                <strong>Use your workspace:</strong> Press <span class="file-path">‚åò‚å•‚åÉG</span> for gentle arrangement or <span class="file-path">‚åò‚å•‚åÉW</span> for full reset!
            </div>
        </div>
    </div>

    <script>
        // Available applications - Jeff's actual workflow apps
        const apps = [
            'Microsoft Outlook', 'Microsoft Teams', 'Notion', 'Red Sands', 'ChatGPT',
            'Claude', 'Perplexity- Ask Anything', 'Cursor', 'GitHub Desktop', 'Messages',
            'Microsoft Excel', 'Microsoft Word', 'Microsoft PowerPoint', 'Hammerspoon',
            'Google Chrome', 'Microsoft Edge', 'Safari', 'Perplexity Comet'
        ];

        // Workspace configuration
        let workspaceConfig = {
            monitor1: { split: 'split-2', apps: { top: null, bottom: null } },
            monitor2: { split: 'split-2', apps: { top: null, bottom: null } },
            monitor3: { split: 'single', apps: { full: null } },
            monitor4: { split: 'single', apps: { full: null } }
        };

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing workspace designer...');
            initializeDragAndDrop();
            initializeSplitSelectors();
            populateDropdowns();
            generateScript();
        });

        function populateDropdowns() {
            console.log('Populating dropdowns with apps:', apps);
            document.querySelectorAll('.zone-selector').forEach(select => {
                select.innerHTML = '<option value="">Choose an app...</option>';
                apps.forEach(app => {
                    const option = document.createElement('option');
                    option.value = app;
                    option.textContent = app;
                    select.appendChild(option);
                });
                
                select.addEventListener('change', function() {
                    if (this.value) {
                        const monitor = this.dataset.monitor;
                        const zone = this.dataset.zone;
                        assignAppToZone(monitor, zone, this.value);
                    }
                });
            });
        }

        function initializeDragAndDrop() {
            console.log('Initializing drag and drop...');
            // Make app items draggable
            const appItems = document.querySelectorAll('.app-item');
            console.log('Found app items:', appItems.length);
            appItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });

            // Make drop zones droppable
            const dropZones = document.querySelectorAll('.drop-zone');
            console.log('Found drop zones:', dropZones.length);
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            console.log('Drag start:', e.target.dataset.app);
            e.dataTransfer.setData('text/plain', e.target.dataset.app);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const app = e.dataTransfer.getData('text/plain');
            const monitor = e.currentTarget.dataset.monitor;
            const zone = e.currentTarget.dataset.zone;
            
            console.log('Drop:', app, 'onto monitor', monitor, 'zone', zone);
            assignAppToZone(monitor, zone, app);
            e.currentTarget.classList.remove('drag-over');
        }

        function assignAppToZone(monitor, zone, app) {
            console.log('Assigning app:', app, 'to monitor:', monitor, 'zone:', zone);
            const monitorKey = 'monitor' + monitor;
            workspaceConfig[monitorKey].apps[zone] = app;
            
            updateZoneDisplay(monitor, zone, app);
            updateDropdown(monitor, zone, app);
            generateScript();
        }

        function updateZoneDisplay(monitor, zone, app) {
            const zoneElement = document.querySelector('[data-monitor="' + monitor + '"][data-zone="' + zone + '"]');
            if (zoneElement) {
                zoneElement.classList.add('has-app');
                zoneElement.innerHTML = '<div class="app-in-zone">' + app + '</div><button class="remove-app" onclick="removeApp(\'' + monitor + '\', \'' + zone + '\')">&times;</button>';
            }
        }

        function updateDropdown(monitor, zone, app) {
            const dropdown = document.querySelector('select[data-monitor="' + monitor + '"][data-zone="' + zone + '"]');
            if (dropdown) {
                dropdown.value = app;
            }
        }

        function removeApp(monitor, zone) {
            const monitorKey = 'monitor' + monitor;
            workspaceConfig[monitorKey].apps[zone] = null;
            
            const zoneElement = document.querySelector('[data-monitor="' + monitor + '"][data-zone="' + zone + '"]');
            zoneElement.classList.remove('has-app');
            
            const zoneNames = {
                top: 'Top Half', bottom: 'Bottom Half', full: 'Fullscreen',
                left: 'Left Half', right: 'Right Half', left3: '1/3', center3: '1/3', right3: '1/3'
            };
            
            zoneElement.innerHTML = '<div>Drop app here or click to select</div><div style="font-size: 0.8rem; color: #999;">' + (zoneNames[zone] || zone) + '</div><select class="zone-selector" data-monitor="' + monitor + '" data-zone="' + zone + '"><option value="">Choose an app...</option></select>';
            
            // Repopulate dropdown
            const newSelect = zoneElement.querySelector('.zone-selector');
            apps.forEach(app => {
                const option = document.createElement('option');
                option.value = app;
                option.textContent = app;
                newSelect.appendChild(option);
            });
            
            newSelect.addEventListener('change', function() {
                if (this.value) {
                    assignAppToZone(this.dataset.monitor, this.dataset.zone, this.value);
                }
            });
            
            generateScript();
        }

        function initializeSplitSelectors() {
            const selectors = document.querySelectorAll('.split-selector');
            selectors.forEach(selector => {
                selector.addEventListener('change', function() {
                    const monitor = this.dataset.monitor;
                    const split = this.value;
                    updateMonitorSplit(monitor, split);
                });
            });
        }

        function updateMonitorSplit(monitor, split) {
            const monitorKey = 'monitor' + monitor;
            workspaceConfig[monitorKey].split = split;
            
            const zonesContainer = document.querySelector('.monitor' + monitor + ' .monitor-zones');
            zonesContainer.className = 'monitor-zones ' + split;
            
            // Clear current zones and create new ones
            zonesContainer.innerHTML = '';
            
            if (split === 'single') {
                zonesContainer.innerHTML = '<div class="drop-zone" data-monitor="' + monitor + '" data-zone="full"><div>Drop app here or click to select</div><div style="font-size: 0.8rem; color: #999;">Fullscreen</div><select class="zone-selector" data-monitor="' + monitor + '" data-zone="full"><option value="">Choose an app...</option></select></div>';
                workspaceConfig[monitorKey].apps = { full: null };
            } else if (split === 'split-2') {
                if (monitor === '4') {
                    // MacBook - left/right split
                    zonesContainer.innerHTML = '<div class="drop-zone" data-monitor="' + monitor + '" data-zone="left"><div>Drop app here or click to select</div><div style="font-size: 0.8rem; color: #999;">Left Half</div><select class="zone-selector" data-monitor="' + monitor + '" data-zone="left"><option value="">Choose an app...</option></select></div><div class="drop-zone" data-monitor="' + monitor + '" data-zone="right"><div>Drop app here or click to select</div><div style="font-size: 0.8rem; color: #999;">Right Half</div><select class="zone-selector" data-monitor="' + monitor + '" data-zone="right"><option value="">Choose an app...</option></select></div>';
                    workspaceConfig[monitorKey].apps = { left: null, right: null };
                } else {
                    // Vertical monitors or ultrawide - top/bottom split
                    zonesContainer.innerHTML = '<div class="drop-zone" data-monitor="' + monitor + '" data-zone="top"><div>Drop app here or click to select</div><div style="font-size: 0.8rem; color: #999;">Top Half</div><select class="zone-selector" data-monitor="' + monitor + '" data-zone="top"><option value="">Choose an app...</option></select></div><div class="drop-zone" data-monitor="' + monitor + '" data-zone="bottom"><div>Drop app here or click to select</div><div style="font-size: 0.8rem; color: #999;">Bottom Half</div><select class="zone-selector" data-monitor="' + monitor + '" data-zone="bottom"><option value="">Choose an app...</option></select></div>';
                    workspaceConfig[monitorKey].apps = { top: null, bottom: null };
                }
            } else if (split === 'split-3') {
                zonesContainer.innerHTML = '<div class="drop-zone" data-monitor="' + monitor + '" data-zone="left3"><div>Drop app here or click to select</div><div style="font-size: 0.8rem; color: #999;">1/3</div><select class="zone-selector" data-monitor="' + monitor + '" data-zone="left3"><option value="">Choose an app...</option></select></div><div class="drop-zone" data-monitor="' + monitor + '" data-zone="center3"><div>Drop app here or click to select</div><div style="font-size: 0.8rem; color: #999;">1/3</div><select class="zone-selector" data-monitor="' + monitor + '" data-zone="center3"><option value="">Choose an app...</option></select></div><div class="drop-zone" data-monitor="' + monitor + '" data-zone="right3"><div>Drop app here or click to select</div><div style="font-size: 0.8rem; color: #999;">1/3</div><select class="zone-selector" data-monitor="' + monitor + '" data-zone="right3"><option value="">Choose an app...</option></select></div>';
                workspaceConfig[monitorKey].apps = { left3: null, center3: null, right3: null };
            }
            
            // Re-initialize drag and drop for new zones
            initializeDragAndDrop();
            populateDropdowns();
            generateScript();
        }

        function generateScript() {
            let script = '-- Hammerspoon Workspace Configuration\\n';
            script += '-- Generated by Workspace Designer\\n';
            script += '-- Two modes: Gentle (‚åò‚å•‚åÉG) and Full Reset (‚åò‚å•‚åÉW)\\n\\n';
            
            // Check if current workspace has apps
            const hasApps = Object.values(workspaceConfig).some(monitor => 
                Object.values(monitor.apps).some(app => app !== null)
            );
            
            if (hasApps) {
                // Generate both modes
                script += generateGentleMode();
                script += '\\n\\n';
                script += generateFullResetMode();
            } else {
                script += '-- Configure your workspace above to generate Lua code';
            }
            
            document.getElementById('generatedCode').textContent = script;
        }
        
        function generateGentleMode() {
            let script = '-- GENTLE MODE: Arrange windows without closing apps\\n';
            script += 'hs.hotkey.bind({"cmd","alt","ctrl"}, "G", function()\\n';
            script += '  local screens = {\\n';
            script += '    one = hs.screen.find(5),\\n';
            script += '    two = hs.screen.find(2),\\n';
            script += '    three = hs.screen.find(3),\\n';
            script += '    four = hs.screen.find(1)\\n';
            script += '  }\\n\\n';
            
            script += '  local function arrangeWindow(appName, screen, x, y, w, h)\\n';
            script += '    local app = hs.application.find(appName)\\n';
            script += '    if app then\\n';
            script += '      local win = app:mainWindow()\\n';
            script += '      if win and screen then\\n';
            script += '        local f = screen:frame()\\n';
            script += '        win:moveToScreen(screen)\\n';
            script += '        win:setFrame({x=f.x+f.w*x, y=f.y+f.h*y, w=f.w*w, h=f.h*h})\\n';
            script += '      end\\n';
            script += '    end\\n';
            script += '  end\\n\\n';
            
            // Add arrangement calls for each configured app
            script += generateArrangementCalls();
            
            script += 'end)';
            return script;
        }
        
        function generateFullResetMode() {
            let script = '-- FULL RESET MODE: Close and restart everything\\n';
            script += 'hs.hotkey.bind({"cmd","alt","ctrl"}, "W", function()\\n';
            script += '  -- Close all apps except essentials\\n';
            script += '  local toKeep = {\\n';
            script += '    ["Hammerspoon"]=true,\\n';
            script += '    ["Finder"]=true,\\n';
            script += '    ["Raycast"]=true,\\n';
            script += '    ["Wispr Flow"]=true,\\n';
            script += '    ["Hand Mirror"]=true\\n';
            script += '  }\\n\\n';
            
            script += '  for _, app in ipairs(hs.application.runningApplications()) do\\n';
            script += '    local name = app:name()\\n';
            script += '    if name and not toKeep[name] then app:kill() end\\n';
            script += '  end\\n\\n';
            
            script += '  hs.timer.doAfter(3, function()\\n';
            script += '    local screens = {\\n';
            script += '      one = hs.screen.find(5),\\n';
            script += '      two = hs.screen.find(2),\\n';
            script += '      three = hs.screen.find(3),\\n';
            script += '      four = hs.screen.find(1)\\n';
            script += '    }\\n\\n';
            
            // Launch apps
            const allApps = new Set();
            Object.values(workspaceConfig).forEach(monitor => {
                Object.values(monitor.apps).forEach(app => {
                    if (app) allApps.add(app);
                });
            });
            
            allApps.forEach(app => {
                script += '    hs.application.launchOrFocus("' + app + '")\\n';
            });
            
            script += '\\n    hs.timer.doAfter(8, function()\\n';
            script += '      local function arrangeWindow(appName, screen, x, y, w, h)\\n';
            script += '        local app = hs.application.find(appName)\\n';
            script += '        if app then\\n';
            script += '          local win = app:mainWindow()\\n';
            script += '          if win and screen then\\n';
            script += '            local f = screen:frame()\\n';
            script += '            win:moveToScreen(screen)\\n';
            script += '            win:setFrame({x=f.x+f.w*x, y=f.y+f.h*y, w=f.w*w, h=f.h*h})\\n';
            script += '          end\\n';
            script += '        end\\n';
            script += '      end\\n\\n';
            script += generateArrangementCalls();
            script += '    end)\\n';
            script += '  end)\\n';
            script += 'end)';
            
            return script;
        }
        
        function generateArrangementCalls() {
            let script = '';
            
            Object.entries(workspaceConfig).forEach(([monitorKey, monitor], index) => {
                const screenVar = ['screens.one', 'screens.two', 'screens.three', 'screens.four'][index];
                
                Object.entries(monitor.apps).forEach(([zone, app]) => {
                    if (app) {
                        script += '  arrangeWindow("' + app + '", ' + screenVar + ', ';
                        
                        if (zone === 'full') {
                            script += '0, 0, 1, 1) -- Fullscreen\\n';
                        } else if (zone === 'top') {
                            script += '0, 0, 1, 0.5) -- Top half\\n';
                        } else if (zone === 'bottom') {
                            script += '0, 0.5, 1, 0.5) -- Bottom half\\n';
                        } else if (zone === 'left') {
                            script += '0, 0, 0.5, 1) -- Left half\\n';
                        } else if (zone === 'right') {
                            script += '0.5, 0, 0.5, 1) -- Right half\\n';
                        } else if (zone === 'left3') {
                            script += '0, 0, 0.33, 1) -- Left third\\n';
                        } else if (zone === 'center3') {
                            script += '0.33, 0, 0.34, 1) -- Center third\\n';
                        } else if (zone === 'right3') {
                            script += '0.67, 0, 0.33, 1) -- Right third\\n';
                        }
                    }
                });
            });
            
            return script;
        }

        function copyScript() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('Script copied to clipboard!');
            });
        }

        function downloadScript() {
            const code = document.getElementById('generatedCode').textContent;
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'hammerspoon-config.lua';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Simplified preset functions for future implementation
        function savePreset() {
            alert('Preset saving will be implemented in the next version');
        }

    </script>
</body>
</html>