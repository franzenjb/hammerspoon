<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hammerspoon Workspace Designer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
            overflow-x: auto;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            flex: 1;
            height: calc(100vh - 280px);
            overflow: hidden;
        }

        /* WORKSPACE DESIGNER - 50% of screen */
        .workspace-designer {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .designer-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 25px;
            text-align: center;
            color: #4a5568;
        }

        .monitors-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            height: 100%;
            min-height: 600px;
        }

        .monitor-container {
            background: #f7fafc;
            border: 3px solid #4a5568;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .monitor-container:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Different monitor sizes */
        .monitor1 { grid-column: 1; grid-row: 1; }
        .monitor2 { grid-column: 2; grid-row: 1; }
        .monitor3 { grid-column: 1 / 3; grid-row: 2; }
        .monitor4 { 
            grid-column: 1 / 3; 
            grid-row: 3; 
            height: 150px;
        }

        .monitor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .monitor-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #2d3748;
        }

        .split-selector {
            padding: 5px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: white;
            font-size: 0.9rem;
        }

        .monitor-zones {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .drop-zone {
            background: white;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: #718096;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .drop-zone:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .drop-zone.has-app {
            border-style: solid;
            border-color: #667eea;
            background: #e6f3ff;
        }

        .app-in-zone {
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .zone-selector {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: white;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .remove-app {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Ultrawide splits */
        .monitor3 .monitor-zones.split-2 {
            flex-direction: row;
        }

        .monitor3 .monitor-zones.split-3 {
            flex-direction: row;
        }

        /* RIGHT SIDEBAR */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            height: 100%;
        }

        /* Workspace Presets */
        .preset-manager {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .preset-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .preset-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .preset-input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.9rem;
            flex: 1;
            min-width: 120px;
        }

        .preset-list {
            max-height: 150px;
            overflow-y: auto;
        }

        .preset-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preset-item.active {
            border-color: #667eea;
            background: #e6f3ff;
        }

        .preset-info {
            flex: 1;
        }

        .preset-name {
            font-weight: bold;
            color: #4a5568;
            font-size: 0.9rem;
        }

        .preset-hotkey {
            font-size: 0.8rem;
            color: #666;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .preset-actions {
            display: flex;
            gap: 5px;
        }

        .preset-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .preset-btn.load {
            background: #667eea;
            color: white;
        }

        .preset-btn.delete {
            background: #e53e3e;
            color: white;
        }

        .app-library {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .library-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .app-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .app-item {
            background: #667eea;
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            cursor: grab;
            font-size: 0.9rem;
            transition: transform 0.2s ease;
        }

        .app-item:hover {
            transform: scale(1.05);
        }

        .app-item:active {
            cursor: grabbing;
        }

        .generated-script {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 250px;
            flex-shrink: 0;
        }

        .script-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .code-preview {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            overflow-y: auto;
            max-height: 200px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        /* Keystroke Display */
        .keystroke-display {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            flex-shrink: 0;
        }

        .hotkey {
            font-size: 2rem;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            background: #f7fafc;
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid #667eea;
            display: inline-block;
        }

        .hotkey-desc {
            font-size: 1rem;
            color: #666;
        }

        /* Installation Instructions */
        .installation-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .installation-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .step {
            margin-bottom: 15px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .step-number {
            font-weight: bold;
            color: #667eea;
            margin-right: 8px;
        }

        .file-path {
            background: #2d3748;
            color: #e2e8f0;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }

        /* Drag and Drop Effects */
        .dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .drag-over {
            border-color: #38a169 !important;
            background: #f0fff4 !important;
            border-style: solid !important;
        }

        /* Bottom Instructions */
        .bottom-instructions {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 20px;
            flex-shrink: 0;
            max-height: 200px;
            overflow-y: auto;
        }

        @media (max-width: 1200px) {
            .container {
                height: auto;
                min-height: calc(100vh - 40px);
            }
            
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
                height: auto;
                min-height: calc(100vh - 300px);
            }
            
            .sidebar {
                height: auto;
            }
            
            .bottom-instructions {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🖥️ Hammerspoon Workspace Designer</h1>
            <p>Drag applications onto monitors • Configure splits • Generate Lua script</p>
        </div>

        <!-- Current Preset Display -->
        <div class="keystroke-display">
            <div class="hotkey" id="hotkeyDisplay">⌘ + ⌥ + ⌃ + W</div>
            <div class="hotkey-desc" id="presetDesc">Default Workspace - Drag apps to configure</div>
        </div>

        <div class="main-content">
            <!-- WORKSPACE DESIGNER -->
            <div class="workspace-designer">
                <div class="designer-title">Visual Workspace Configuration</div>
                <div class="monitors-grid">
                    
                    <!-- Monitor 1 -->
                    <div class="monitor-container monitor1">
                        <div class="monitor-header">
                            <div class="monitor-name">Monitor 1 (Samsung LU28R55)</div>
                            <select class="split-selector" data-monitor="1">
                                <option value="single">Single App</option>
                                <option value="split-2" selected>Top/Bottom Split</option>
                            </select>
                        </div>
                        <div class="monitor-zones split-2">
                            <div class="drop-zone" data-monitor="1" data-zone="top">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Top Half</div>
                                <select class="zone-selector" data-monitor="1" data-zone="top">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                            <div class="drop-zone" data-monitor="1" data-zone="bottom">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Bottom Half</div>
                                <select class="zone-selector" data-monitor="1" data-zone="bottom">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Monitor 2 -->
                    <div class="monitor-container monitor2">
                        <div class="monitor-header">
                            <div class="monitor-name">Monitor 2 (Samsung LU28R55)</div>
                            <select class="split-selector" data-monitor="2">
                                <option value="single">Single App</option>
                                <option value="split-2" selected>Top/Bottom Split</option>
                            </select>
                        </div>
                        <div class="monitor-zones split-2">
                            <div class="drop-zone" data-monitor="2" data-zone="top">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Top Half</div>
                                <select class="zone-selector" data-monitor="2" data-zone="top">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                            <div class="drop-zone" data-monitor="2" data-zone="bottom">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Bottom Half</div>
                                <select class="zone-selector" data-monitor="2" data-zone="bottom">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Monitor 3 (Ultrawide) -->
                    <div class="monitor-container monitor3">
                        <div class="monitor-header">
                            <div class="monitor-name">Monitor 3 (LG UltraWide)</div>
                            <select class="split-selector" data-monitor="3">
                                <option value="single" selected>Single App (Fullscreen)</option>
                                <option value="split-2">50/50 Split</option>
                                <option value="split-3">1/3 • 1/3 • 1/3 Split</option>
                            </select>
                        </div>
                        <div class="monitor-zones single">
                            <div class="drop-zone" data-monitor="3" data-zone="full">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Fullscreen</div>
                                <select class="zone-selector" data-monitor="3" data-zone="full">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Monitor 4 (MacBook) -->
                    <div class="monitor-container monitor4">
                        <div class="monitor-header">
                            <div class="monitor-name">Monitor 4 (MacBook Retina)</div>
                            <select class="split-selector" data-monitor="4">
                                <option value="single" selected>Single App</option>
                                <option value="split-2">Left/Right Split</option>
                            </select>
                        </div>
                        <div class="monitor-zones single">
                            <div class="drop-zone" data-monitor="4" data-zone="full">
                                <div>Drop app here or click to select</div>
                                <div style="font-size: 0.8rem; color: #999;">Fullscreen</div>
                                <select class="zone-selector" data-monitor="4" data-zone="full">
                                    <option value="">Choose an app...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="sidebar">
                <!-- Workspace Presets -->
                <div class="preset-manager">
                    <div class="preset-title">🏠 Workspace Presets</div>
                    
                    <div class="preset-controls">
                        <input type="text" id="presetName" class="preset-input" placeholder="Preset name (e.g., Development Mode)">
                        <select id="presetHotkey" class="preset-input">
                            <option value="cmd,alt,ctrl,W">⌘⌥⌃W</option>
                            <option value="cmd,alt,ctrl,D">⌘⌥⌃D</option>
                            <option value="cmd,alt,ctrl,M">⌘⌥⌃M</option>
                            <option value="cmd,alt,ctrl,F">⌘⌥⌃F</option>
                            <option value="cmd,alt,ctrl,1">⌘⌥⌃1</option>
                            <option value="cmd,alt,ctrl,2">⌘⌥⌃2</option>
                            <option value="cmd,alt,ctrl,3">⌘⌥⌃3</option>
                        </select>
                        <button class="btn btn-primary" onclick="savePreset()" style="flex: none;">Save</button>
                    </div>
                    
                    <div class="preset-list" id="presetList">
                        <!-- Presets will be populated here -->
                    </div>
                </div>

                <!-- App Library -->
                <div class="app-library">
                    <div class="library-title">📱 Application Library</div>
                    <div class="app-grid">
                        <div class="app-item" draggable="true" data-app="Microsoft Outlook">Outlook</div>
                        <div class="app-item" draggable="true" data-app="Microsoft Teams">Teams</div>
                        <div class="app-item" draggable="true" data-app="Notion">Notion</div>
                        <div class="app-item" draggable="true" data-app="Red Sands">Red Sands</div>
                        <div class="app-item" draggable="true" data-app="ChatGPT">ChatGPT</div>
                        <div class="app-item" draggable="true" data-app="Claude">Claude</div>
                        <div class="app-item" draggable="true" data-app="Perplexity- Ask Anything">Perplexity</div>
                        <div class="app-item" draggable="true" data-app="Cursor">Cursor</div>
                        <div class="app-item" draggable="true" data-app="GitHub Desktop">GitHub</div>
                        <div class="app-item" draggable="true" data-app="Messages">Messages</div>
                        <div class="app-item" draggable="true" data-app="Microsoft Excel">Excel</div>
                        <div class="app-item" draggable="true" data-app="Microsoft Word">Word</div>
                        <div class="app-item" draggable="true" data-app="Microsoft PowerPoint">PowerPoint</div>
                        <div class="app-item" draggable="true" data-app="Hammerspoon">Console</div>
                        <div class="app-item" draggable="true" data-app="Google Chrome">Chrome</div>
                        <div class="app-item" draggable="true" data-app="Microsoft Edge">Edge</div>
                        <div class="app-item" draggable="true" data-app="Safari">Safari</div>
                        <div class="app-item" draggable="true" data-app="Perplexity Comet">Comet</div>
                    </div>
                </div>

                <!-- Generated Script -->
                <div class="generated-script">
                    <div class="script-title">⚡ Generated Lua Script</div>
                    <div class="code-preview" id="generatedCode">
-- Configure your workspace above
-- Script will generate automatically
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="copyScript()">📋 Copy Script</button>
                        <button class="btn btn-secondary" onclick="downloadScript()">💾 Download</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Instructions -->
        <div class="bottom-instructions">
            <div class="installation-title">📥 How to Install in Hammerspoon</div>
            
            <div class="step">
                <span class="step-number">1.</span>
                <strong>Install Hammerspoon:</strong> Download from <a href="https://www.hammerspoon.org/" target="_blank">hammerspoon.org</a> if you haven't already
            </div>
            
            <div class="step">
                <span class="step-number">2.</span>
                <strong>Create workspace presets:</strong> Configure different layouts above and save them with unique names and hotkeys
            </div>
            
            <div class="step">
                <span class="step-number">3.</span>
                <strong>Copy generated script:</strong> Use the "Copy Script" button - it includes ALL your saved presets
            </div>
            
            <div class="step">
                <span class="step-number">4.</span>
                <strong>Open Hammerspoon config:</strong> Click Hammerspoon menu bar icon → "Open Config" or edit <span class="file-path">~/.hammerspoon/init.lua</span>
            </div>
            
            <div class="step">
                <span class="step-number">5.</span>
                <strong>Paste into config:</strong> Add the generated code to your <span class="file-path">init.lua</span> file (replace any existing workspace code)
            </div>
            
            <div class="step">
                <span class="step-number">6.</span>
                <strong>Reload Hammerspoon:</strong> Click Hammerspoon menu bar icon → "Reload Config" or press <span class="file-path">⌘⌥⌃R</span>
            </div>
            
            <div class="step">
                <span class="step-number">7.</span>
                <strong>Test your workspaces:</strong> Use each preset's unique hotkey to switch between different workspace layouts!
            </div>
        </div>
    </div>

    <script>
        // Workspace configuration
        let workspaceConfig = {
            monitor1: { split: 'split-2', apps: { top: null, bottom: null } },
            monitor2: { split: 'split-2', apps: { top: null, bottom: null } },
            monitor3: { split: 'single', apps: { full: null } },
            monitor4: { split: 'single', apps: { full: null } }
        };

        // Available applications - Jeff's actual workflow apps
        const apps = [
            'Microsoft Outlook', 'Microsoft Teams', 'Notion', 'Red Sands', 'ChatGPT',
            'Claude', 'Perplexity- Ask Anything', 'Cursor', 'GitHub Desktop', 'Messages',
            'Microsoft Excel', 'Microsoft Word', 'Microsoft PowerPoint', 'Hammerspoon',
            'Google Chrome', 'Microsoft Edge', 'Safari', 'Perplexity Comet'
        ];

        // Current hotkey configuration
        let currentHotkey = { keys: ['cmd', 'alt', 'ctrl'], trigger: 'W', display: '⌘ + ⌥ + ⌃ + W' };
        
        // Preset management
        let workspacePresets = {};
        let currentPresetId = 'default';
        let currentPresetName = 'Default Workspace';

        // Initialize drag and drop
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
            initializeSplitSelectors();
            populateDropdowns();
            loadPresets();
            updatePresetDisplay();
            generateScript();
        });

        function savePreset() {
            const nameInput = document.getElementById('presetName');
            const hotkeySelect = document.getElementById('presetHotkey');
            
            const name = nameInput.value.trim();
            if (!name) {
                alert('Please enter a preset name');
                return;
            }
            
            const hotkeyValue = hotkeySelect.value;
            const parts = hotkeyValue.split(',');
            const trigger = parts.pop();
            const keys = parts;
            
            const displayMap = {
                'cmd': '⌘', 'alt': '⌥', 'ctrl': '⌃', 'shift': '⇧'
            };
            const displayKeys = keys.map(k => displayMap[k] || k).join(' + ');
            const hotkeyDisplay = `${displayKeys} + ${trigger}`;
            
            const presetId = Date.now().toString();
            workspacePresets[presetId] = {
                id: presetId,
                name: name,
                hotkey: { keys, trigger, display: hotkeyDisplay },
                config: JSON.parse(JSON.stringify(workspaceConfig))
            };
            
            // Save to localStorage
            localStorage.setItem('hammerspoonPresets', JSON.stringify(workspacePresets));
            
            // Clear inputs
            nameInput.value = '';
            
            // Update display
            renderPresetList();
            generateScript();
        }
        
        function loadPresets() {
            const saved = localStorage.getItem('hammerspoonPresets');
            if (saved) {
                workspacePresets = JSON.parse(saved);
            }
            renderPresetList();
        }
        
        function renderPresetList() {
            const list = document.getElementById('presetList');
            list.innerHTML = '';
            
            Object.values(workspacePresets).forEach(preset => {
                const item = document.createElement('div');
                item.className = `preset-item ${preset.id === currentPresetId ? 'active' : ''}`;
                item.innerHTML = `
                    <div class="preset-info">
                        <div class="preset-name">${preset.name}</div>
                        <div class="preset-hotkey">${preset.hotkey.display}</div>
                    </div>
                    <div class="preset-actions">
                        <button class="preset-btn load" onclick="loadPreset('${preset.id}')">Load</button>
                        <button class="preset-btn delete" onclick="deletePreset('${preset.id}')">Delete</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        function loadPreset(presetId) {
            if (!workspacePresets[presetId]) return;
            
            const preset = workspacePresets[presetId];
            currentPresetId = presetId;
            currentPresetName = preset.name;
            currentHotkey = preset.hotkey;
            workspaceConfig = JSON.parse(JSON.stringify(preset.config));
            
            // Update UI
            updatePresetDisplay();
            updateMonitorDisplays();
            renderPresetList();
            generateScript();
        }
        
        function deletePreset(presetId) {
            if (confirm('Delete this preset?')) {
                delete workspacePresets[presetId];
                localStorage.setItem('hammerspoonPresets', JSON.stringify(workspacePresets));
                
                if (currentPresetId === presetId) {
                    currentPresetId = 'default';
                    currentPresetName = 'Default Workspace';
                    resetToDefault();
                }
                
                renderPresetList();
                generateScript();
            }
        }
        
        function updatePresetDisplay() {
            document.getElementById('hotkeyDisplay').textContent = currentHotkey.display;
            document.getElementById('presetDesc').textContent = `${currentPresetName} - Configure your apps`;
        }
        
        function resetToDefault() {
            workspaceConfig = {
                monitor1: { split: 'split-2', apps: { top: null, bottom: null } },
                monitor2: { split: 'split-2', apps: { top: null, bottom: null } },
                monitor3: { split: 'single', apps: { full: null } },
                monitor4: { split: 'single', apps: { full: null } }
            };
            currentHotkey = { keys: ['cmd', 'alt', 'ctrl'], trigger: 'W', display: '⌘ + ⌥ + ⌃ + W' };
            updateMonitorDisplays();
            updatePresetDisplay();
        }
        
        function updateMonitorDisplays() {
            // Reset all monitor displays to match workspaceConfig
            ['1', '2', '3', '4'].forEach(monitor => {
                const monitorKey = `monitor${monitor}`;
                const config = workspaceConfig[monitorKey];
                
                // Update split selector
                const splitSelector = document.querySelector(`[data-monitor="${monitor}"] .split-selector`);
                if (splitSelector) {
                    splitSelector.value = config.split;
                    updateMonitorSplit(monitor, config.split);
                }
                
                // Update apps in zones
                Object.entries(config.apps).forEach(([zone, app]) => {
                    if (app) {
                        updateZoneDisplay(monitor, zone, app);
                        updateDropdown(monitor, zone, app);
                    }
                });
            });
        }

        function populateDropdowns() {
            document.querySelectorAll('.zone-selector').forEach(select => {
                select.innerHTML = '<option value="">Choose an app...</option>';
                apps.forEach(app => {
                    select.innerHTML += `<option value="${app}">${app}</option>`;
                });
                
                select.addEventListener('change', function() {
                    if (this.value) {
                        const monitor = this.dataset.monitor;
                        const zone = this.dataset.zone;
                        assignAppToZone(monitor, zone, this.value);
                    }
                });
            });
        }

        function initializeDragAndDrop() {
            // Make app items draggable
            const appItems = document.querySelectorAll('.app-item');
            appItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });

            // Make drop zones droppable
            const dropZones = document.querySelectorAll('.drop-zone');
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.app);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const app = e.dataTransfer.getData('text/plain');
            const monitor = e.currentTarget.dataset.monitor;
            const zone = e.currentTarget.dataset.zone;
            
            assignAppToZone(monitor, zone, app);
            e.currentTarget.classList.remove('drag-over');
        }

        function assignAppToZone(monitor, zone, app) {
            const monitorKey = `monitor${monitor}`;
            workspaceConfig[monitorKey].apps[zone] = app;
            
            updateZoneDisplay(monitor, zone, app);
            updateDropdown(monitor, zone, app);
            generateScript();
        }

        function updateZoneDisplay(monitor, zone, app) {
            const zoneElement = document.querySelector(`[data-monitor="${monitor}"][data-zone="${zone}"]`);
            zoneElement.classList.add('has-app');
            zoneElement.innerHTML = `
                <div class="app-in-zone">${app}</div>
                <button class="remove-app" onclick="removeApp('${monitor}', '${zone}')">&times;</button>
            `;
        }

        function updateDropdown(monitor, zone, app) {
            const dropdown = document.querySelector(`select[data-monitor="${monitor}"][data-zone="${zone}"]`);
            if (dropdown) {
                dropdown.value = app;
            }
        }

        function removeApp(monitor, zone) {
            const monitorKey = `monitor${monitor}`;
            workspaceConfig[monitorKey].apps[zone] = null;
            
            const zoneElement = document.querySelector(`[data-monitor="${monitor}"][data-zone="${zone}"]`);
            zoneElement.classList.remove('has-app');
            
            const zoneNames = {
                top: 'Top Half', bottom: 'Bottom Half', full: 'Fullscreen',
                left: 'Left Half', right: 'Right Half', left3: '1/3', center3: '1/3', right3: '1/3'
            };
            
            zoneElement.innerHTML = `
                <div>Drop app here or click to select</div>
                <div style="font-size: 0.8rem; color: #999;">${zoneNames[zone] || zone}</div>
                <select class="zone-selector" data-monitor="${monitor}" data-zone="${zone}">
                    <option value="">Choose an app...</option>
                </select>
            `;
            
            // Repopulate dropdown
            const newSelect = zoneElement.querySelector('.zone-selector');
            apps.forEach(app => {
                newSelect.innerHTML += `<option value="${app}">${app}</option>`;
            });
            
            newSelect.addEventListener('change', function() {
                if (this.value) {
                    assignAppToZone(this.dataset.monitor, this.dataset.zone, this.value);
                }
            });
            
            generateScript();
        }

        function initializeSplitSelectors() {
            const selectors = document.querySelectorAll('.split-selector');
            selectors.forEach(selector => {
                selector.addEventListener('change', function() {
                    const monitor = this.dataset.monitor;
                    const split = this.value;
                    updateMonitorSplit(monitor, split);
                });
            });
        }

        function updateMonitorSplit(monitor, split) {
            const monitorKey = `monitor${monitor}`;
            workspaceConfig[monitorKey].split = split;
            
            const zonesContainer = document.querySelector(`.monitor${monitor} .monitor-zones`);
            zonesContainer.className = `monitor-zones ${split}`;
            
            // Clear current zones and create new ones
            zonesContainer.innerHTML = '';
            
            if (split === 'single') {
                zonesContainer.innerHTML = `
                    <div class="drop-zone" data-monitor="${monitor}" data-zone="full">
                        <div>Drop app here or click to select</div>
                        <div style="font-size: 0.8rem; color: #999;">Fullscreen</div>
                        <select class="zone-selector" data-monitor="${monitor}" data-zone="full">
                            <option value="">Choose an app...</option>
                        </select>
                    </div>
                `;
                workspaceConfig[monitorKey].apps = { full: null };
            } else if (split === 'split-2') {
                if (monitor === '4') {
                    // MacBook - left/right split
                    zonesContainer.innerHTML = `
                        <div class="drop-zone" data-monitor="${monitor}" data-zone="left">
                            <div>Drop app here or click to select</div>
                            <div style="font-size: 0.8rem; color: #999;">Left Half</div>
                            <select class="zone-selector" data-monitor="${monitor}" data-zone="left">
                                <option value="">Choose an app...</option>
                            </select>
                        </div>
                        <div class="drop-zone" data-monitor="${monitor}" data-zone="right">
                            <div>Drop app here or click to select</div>
                            <div style="font-size: 0.8rem; color: #999;">Right Half</div>
                            <select class="zone-selector" data-monitor="${monitor}" data-zone="right">
                                <option value="">Choose an app...</option>
                            </select>
                        </div>
                    `;
                    workspaceConfig[monitorKey].apps = { left: null, right: null };
                } else {
                    // Vertical monitors or ultrawide - top/bottom or left/right
                    zonesContainer.innerHTML = `
                        <div class="drop-zone" data-monitor="${monitor}" data-zone="top">
                            <div>Drop app here or click to select</div>
                            <div style="font-size: 0.8rem; color: #999;">Top Half</div>
                            <select class="zone-selector" data-monitor="${monitor}" data-zone="top">
                                <option value="">Choose an app...</option>
                            </select>
                        </div>
                        <div class="drop-zone" data-monitor="${monitor}" data-zone="bottom">
                            <div>Drop app here or click to select</div>
                            <div style="font-size: 0.8rem; color: #999;">Bottom Half</div>
                            <select class="zone-selector" data-monitor="${monitor}" data-zone="bottom">
                                <option value="">Choose an app...</option>
                            </select>
                        </div>
                    `;
                    workspaceConfig[monitorKey].apps = { top: null, bottom: null };
                }
            } else if (split === 'split-3') {
                zonesContainer.innerHTML = `
                    <div class="drop-zone" data-monitor="${monitor}" data-zone="left3">
                        <div>Drop app here or click to select</div>
                        <div style="font-size: 0.8rem; color: #999;">1/3</div>
                        <select class="zone-selector" data-monitor="${monitor}" data-zone="left3">
                            <option value="">Choose an app...</option>
                        </select>
                    </div>
                    <div class="drop-zone" data-monitor="${monitor}" data-zone="center3">
                        <div>Drop app here or click to select</div>
                        <div style="font-size: 0.8rem; color: #999;">1/3</div>
                        <select class="zone-selector" data-monitor="${monitor}" data-zone="center3">
                            <option value="">Choose an app...</option>
                        </select>
                    </div>
                    <div class="drop-zone" data-monitor="${monitor}" data-zone="right3">
                        <div>Drop app here or click to select</div>
                        <div style="font-size: 0.8rem; color: #999;">1/3</div>
                        <select class="zone-selector" data-monitor="${monitor}" data-zone="right3">
                            <option value="">Choose an app...</option>
                        </select>
                    </div>
                `;
                workspaceConfig[monitorKey].apps = { left3: null, center3: null, right3: null };
            }
            
            // Re-initialize drag and drop for new zones
            initializeDragAndDrop();
            populateDropdowns();
            generateScript();
        }

        function generateScript() {
            let script = `-- Hammerspoon Workspace Configuration
-- Generated by Workspace Designer
-- Multiple workspace presets with individual hotkeys
--
-- Installation Instructions:
-- 1. Copy this entire script
-- 2. Open ~/.hammerspoon/init.lua (Hammerspoon menu → "Open Config")
-- 3. Paste this code (replace any existing workspace code)
-- 4. Reload Hammerspoon (menu → "Reload Config" or ⌘⌥⌃R)
-- 5. Use the hotkeys below to activate different workspace layouts!

-- WORKSPACE PRESETS:
`;

            // Add current workspace if it has apps
            const hasApps = Object.values(workspaceConfig).some(monitor => 
                Object.values(monitor.apps).some(app => app !== null)
            );
            
            if (hasApps) {
                const luaKeys = currentHotkey.keys.map(k => `"${k}"`).join(',');
                script += `-- ${currentPresetName}: ${currentHotkey.display}\n`;
                script += generateWorkspaceFunction(currentPresetName, currentHotkey, workspaceConfig);
            }
            
            // Add saved presets
            Object.values(workspacePresets).forEach(preset => {
                const luaKeys = preset.hotkey.keys.map(k => `"${k}"`).join(',');
                script += `\n-- ${preset.name}: ${preset.hotkey.display}\n`;
                script += generateWorkspaceFunction(preset.name, preset.hotkey, preset.config);
            });
            
            document.getElementById('generatedCode').textContent = script;
        }
        
        function generateWorkspaceFunction(name, hotkey, config) {
            const luaKeys = hotkey.keys.map(k => `"${k}"`).join(',');
            
            let script = `hs.hotkey.bind({${luaKeys}}, "${hotkey.trigger}", function()
  -- ${name}
  local toKeep = {
    ["Hammerspoon"]=true,
    ["Finder"]=true,
    ["Raycast"]=true,
    ["Wispr Flow"]=true,
    ["Hand Mirror"]=true
  }
  
  for _, app in ipairs(hs.application.runningApplications()) do
    local name = app:name()
    if name and not toKeep[name] then app:kill() end
  end

  hs.timer.doAfter(3, function()
    local screens = {
      one   = hs.screen.find(5), -- Monitor 1
      two   = hs.screen.find(2), -- Monitor 2  
      three = hs.screen.find(3), -- Monitor 3 (Ultrawide)
      four  = hs.screen.find(1)  -- Monitor 4 (MacBook)
    }
    
    -- Launch applications
`;

            // Add app launches
            const allApps = new Set();
            Object.values(config).forEach(monitor => {
                Object.values(monitor.apps).forEach(app => {
                    if (app) allApps.add(app);
                });
            });

            allApps.forEach(app => {
                script += `    hs.application.launchOrFocus("${app}")\n`;
            });

            script += `
    -- Window arrangement
    hs.timer.doAfter(8, function()
      local function place(win, screen, xFrac, wFrac, yFrac, hFrac)
        if win and screen then
          local f = screen:frame()
          win:moveToScreen(screen)
          win:setFrame({
            x=f.x+f.w*xFrac,
            y=f.y+f.h*yFrac,
            w=f.w*wFrac,
            h=f.h*hFrac
          })
        end
      end
      
      local wins = hs.window.filter.default:getWindows()
`;

            // Generate window placement code for each monitor
            ['monitor1', 'monitor2', 'monitor3', 'monitor4'].forEach((monitorKey, index) => {
                const monitor = config[monitorKey];
                const screenVar = ['screens.one', 'screens.two', 'screens.three', 'screens.four'][index];
                
                Object.entries(monitor.apps).forEach(([zone, app]) => {
                    if (app) {
                        script += `      
      -- ${app} on Monitor ${index + 1} (${zone})
      for _, win in ipairs(wins) do
        if win:application():name() == "${app}" then
          `;
                        
                        if (zone === 'full') {
                            script += `place(win, ${screenVar}, 0, 1, 0, 1) -- Fullscreen`;
                        } else if (zone === 'top') {
                            script += `place(win, ${screenVar}, 0, 1, 0, 0.5) -- Top half`;
                        } else if (zone === 'bottom') {
                            script += `place(win, ${screenVar}, 0, 1, 0.5, 0.5) -- Bottom half`;
                        } else if (zone === 'left') {
                            script += `place(win, ${screenVar}, 0, 0.5, 0, 1) -- Left half`;
                        } else if (zone === 'right') {
                            script += `place(win, ${screenVar}, 0.5, 0.5, 0, 1) -- Right half`;
                        } else if (zone === 'left3') {
                            script += `place(win, ${screenVar}, 0, 0.33, 0, 1) -- Left third`;
                        } else if (zone === 'center3') {
                            script += `place(win, ${screenVar}, 0.33, 0.34, 0, 1) -- Center third`;
                        } else if (zone === 'right3') {
                            script += `place(win, ${screenVar}, 0.67, 0.33, 0, 1) -- Right third`;
                        }
                        
                        script += `
          break
        end
      end`;
                    }
                });
            });

            script += `
    end)
  end)
end)
`;
            
            return script;
        }
  -- Close all apps except essentials
  local toKeep = {
    ["Hammerspoon"]=true,
    ["Finder"]=true,
    ["Raycast"]=true,
    ["Wispr Flow"]=true,
    ["Hand Mirror"]=true
  }
  
  for _, app in ipairs(hs.application.runningApplications()) do
    local name = app:name()
    if name and not toKeep[name] then app:kill() end
  end

  -- Wait and launch apps
  hs.timer.doAfter(3, function()
    local screens = {
      one   = hs.screen.find(5), -- Monitor 1
      two   = hs.screen.find(2), -- Monitor 2  
      three = hs.screen.find(3), -- Monitor 3 (Ultrawide)
      four  = hs.screen.find(1)  -- Monitor 4 (MacBook)
    }
    
    -- Launch applications
`;

            // Add app launches
            const allApps = new Set();
            Object.values(workspaceConfig).forEach(monitor => {
                Object.values(monitor.apps).forEach(app => {
                    if (app) allApps.add(app);
                });
            });

            allApps.forEach(app => {
                script += `    hs.application.launchOrFocus("${app}")\n`;
            });

            script += `
    -- Window arrangement
    hs.timer.doAfter(8, function()
      local function place(win, screen, xFrac, wFrac, yFrac, hFrac)
        if win and screen then
          local f = screen:frame()
          win:moveToScreen(screen)
          win:setFrame({
            x=f.x+f.w*xFrac,
            y=f.y+f.h*yFrac,
            w=f.w*wFrac,
            h=f.h*hFrac
          })
        end
      end
      
      local wins = hs.window.filter.default:getWindows()
`;

            // Generate window placement code for each monitor
            ['monitor1', 'monitor2', 'monitor3', 'monitor4'].forEach((monitorKey, index) => {
                const monitor = workspaceConfig[monitorKey];
                const screenVar = ['screens.one', 'screens.two', 'screens.three', 'screens.four'][index];
                
                Object.entries(monitor.apps).forEach(([zone, app]) => {
                    if (app) {
                        script += `      
      -- ${app} on Monitor ${index + 1} (${zone})
      for _, win in ipairs(wins) do
        if win:application():name() == "${app}" then
          `;
                        
                        if (zone === 'full') {
                            script += `place(win, ${screenVar}, 0, 1, 0, 1) -- Fullscreen`;
                        } else if (zone === 'top') {
                            script += `place(win, ${screenVar}, 0, 1, 0, 0.5) -- Top half`;
                        } else if (zone === 'bottom') {
                            script += `place(win, ${screenVar}, 0, 1, 0.5, 0.5) -- Bottom half`;
                        } else if (zone === 'left') {
                            script += `place(win, ${screenVar}, 0, 0.5, 0, 1) -- Left half`;
                        } else if (zone === 'right') {
                            script += `place(win, ${screenVar}, 0.5, 0.5, 0, 1) -- Right half`;
                        } else if (zone === 'left3') {
                            script += `place(win, ${screenVar}, 0, 0.33, 0, 1) -- Left third`;
                        } else if (zone === 'center3') {
                            script += `place(win, ${screenVar}, 0.33, 0.34, 0, 1) -- Center third`;
                        } else if (zone === 'right3') {
                            script += `place(win, ${screenVar}, 0.67, 0.33, 0, 1) -- Right third`;
                        }
                        
                        script += `
          break
        end
      end`;
                    }
                });
            });

            script += `
    end)
  end)
end)`;

            document.getElementById('generatedCode').textContent = script;
        }

        function copyScript() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✅ Copied!';
                btn.style.background = '#48bb78';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#667eea';
                }, 2000);
            });
        }

        function downloadScript() {
            const code = document.getElementById('generatedCode').textContent;
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'hammerspoon-config.lua';
            a.click();
            URL.revokeObjectURL(url);
        }

    </script>
</body>
</html>